<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMaster AI - Error Solving Chatbot</title>
    
    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            font-size: 13px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #252526;
            border-right: 1px solid #3e3e42;
        }

        .editor-toolbar {
            background: #2d2d30;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid #3e3e42;
        }

        .language-badge {
            background: #667eea;
            color: white;
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .editor-actions {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }

        .toolbar-btn {
            background: #3e3e42;
            color: #cccccc;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toolbar-btn:hover {
            background: #505053;
            color: white;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .analyze-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .analyze-btn:disabled {
            background: #505053;
            cursor: not-allowed;
            transform: none;
        }

        #editor {
            flex: 1;
        }

        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
        }

        .chat-header {
            background: #2d2d30;
            padding: 15px 20px;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            color: #cccccc;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .clear-chat-btn {
            background: transparent;
            color: #858585;
            border: 1px solid #3e3e42;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .clear-chat-btn:hover {
            background: #3e3e42;
            color: #cccccc;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            margin-bottom: 20px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .avatar.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .avatar.bot {
            background: #3e3e42;
        }

        .message-author {
            color: #cccccc;
            font-weight: 600;
            font-size: 13px;
        }

        .message-time {
            color: #858585;
            font-size: 11px;
            margin-left: auto;
        }

        .message-content {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 16px;
            margin-left: 42px;
            color: #cccccc;
            line-height: 1.6;
        }

        .message.bot .message-content {
            background: #2d2d30;
        }

        .error-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .error-badge.yes {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .error-badge.no {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .response-section {
            margin: 16px 0;
        }

        .section-label {
            color: #667eea;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .section-content {
            color: #cccccc;
            line-height: 1.7;
        }

        .code-block-container {
            margin: 12px 0;
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            overflow: hidden;
        }

        .code-block-header {
            background: #2d2d30;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #3e3e42;
        }

        .code-lang-tag {
            color: #858585;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .copy-code-btn {
            background: transparent;
            color: #858585;
            border: 1px solid #3e3e42;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .copy-code-btn:hover {
            background: #3e3e42;
            color: #cccccc;
        }

        .copy-code-btn.copied {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
            border-color: rgba(34, 197, 94, 0.3);
        }

        .code-block-content {
            padding: 16px;
            overflow-x: auto;
        }

        .code-block-content pre {
            margin: 0;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .suggestions-box {
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
            padding: 12px 16px;
            border-radius: 4px;
            color: #cccccc;
        }

        .loading-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #858585;
            font-size: 13px;
        }

        .loading-dots {
            display: flex;
            gap: 4px;
        }

        .loading-dot {
            width: 6px;
            height: 6px;
            background: #667eea;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #3e3e42;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #505053;
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #858585;
        }

        .welcome-message h2 {
            color: #cccccc;
            margin-bottom: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #858585;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="status-indicator"></div>
            <div>
                <h1>ü§ñ CodeMaster AI</h1>
                <p>Intelligent Code Error Detection & Fixing</p>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Editor Panel -->
        <div class="editor-panel">
            <div class="editor-toolbar">
                <span class="language-badge" id="languageBadge">PYTHON</span>
                <div class="editor-actions">
                    <button class="toolbar-btn" onclick="clearEditor()">
                        <span>üóëÔ∏è</span> Clear
                    </button>
                    <button class="toolbar-btn analyze-btn" id="analyzeBtn" onclick="analyzeCode()">
                        <span>üîç</span> Analyze Code
                    </button>
                </div>
            </div>
            <div id="editor"></div>
        </div>

        <!-- Chat Panel -->
        <div class="chat-panel">
            <div class="chat-header">
                <div class="chat-title">
                    <span>üí¨</span> Analysis Results
                </div>
                <button class="clear-chat-btn" onclick="clearChat()">Clear History</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="welcome-message">
                    <h2>üëã Welcome to CodeMaster AI!</h2>
                    <p>Paste your code in the editor and click "Analyze Code" to get started.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000/solve-error';
        let editor;
        let currentLanguage = 'python';

        // Language detection mapping
        const languageKeywords = {
            python: ['def ', 'import ', 'class ', 'print(', '__init__', 'self.', 'elif ', 'from '],
            javascript: ['function ', 'const ', 'let ', 'var ', 'console.', '=>', 'async ', 'await '],
            java: ['public class', 'private ', 'public ', 'void ', 'System.out', 'import java', 'extends ', 'implements '],
            cpp: ['#include', 'std::', 'cout', 'cin', 'namespace ', 'template', 'int main('],
            c: ['#include', 'printf(', 'scanf(', 'int main(', 'void ', 'struct '],
            csharp: ['using System', 'namespace ', 'public class', 'Console.Write', 'static void'],
            php: ['<?php', 'echo ', '$_GET', '$_POST', 'function '],
            ruby: ['def ', 'end', 'puts ', 'require ', 'class ', '@'],
            go: ['package ', 'func ', 'import ', 'fmt.Print', 'var ', 'type ']
        };

        // Initialize Monaco Editor
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
        
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: '# Paste your code here...\n\ndef hello():\n    print("Hello World")',
                language: 'python',
                theme: 'vs-dark',
                fontSize: 14,
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                automaticLayout: true,
                lineNumbers: 'on',
                renderWhitespace: 'selection',
                tabSize: 4,
                wordWrap: 'on'
            });

            // Detect language on content change
            editor.onDidChangeModelContent(() => {
                detectLanguage();
            });
        });

        function detectLanguage() {
            const code = editor.getValue().toLowerCase();
            let detectedLang = 'python';
            let maxScore = 0;

            for (const [lang, keywords] of Object.entries(languageKeywords)) {
                let score = 0;
                for (const keyword of keywords) {
                    if (code.includes(keyword.toLowerCase())) {
                        score++;
                    }
                }
                if (score > maxScore) {
                    maxScore = score;
                    detectedLang = lang;
                }
            }

            if (maxScore > 0 && detectedLang !== currentLanguage) {
                currentLanguage = detectedLang;
                monaco.editor.setModelLanguage(editor.getModel(), detectedLang);
                document.getElementById('languageBadge').textContent = detectedLang.toUpperCase();
            }
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(isUser, content) {
            const messagesContainer = document.getElementById('chatMessages');
            
            // Remove welcome message if exists
            const welcome = messagesContainer.querySelector('.welcome-message');
            if (welcome) welcome.remove();

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <div class="avatar ${isUser ? 'user' : 'bot'}">
                        ${isUser ? 'üë§' : 'ü§ñ'}
                    </div>
                    <span class="message-author">${isUser ? 'You' : 'CodeMaster AI'}</span>
                    <span class="message-time">${getCurrentTime()}</span>
                </div>
                <div class="message-content">
                    ${content}
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function createCodeBlock(code, language, title = '') {
            const blockId = 'code-' + Math.random().toString(36).substr(2, 9);
            const cleanCode = code.replace(/```[\w]*\n?/g, '').replace(/```$/g, '').trim();
            
            return `
                <div class="code-block-container">
                    <div class="code-block-header">
                        <span class="code-lang-tag">${title || language}</span>
                        <button class="copy-code-btn" onclick="copyCode('${blockId}', this)">
                            üìã Copy
                        </button>
                    </div>
                    <div class="code-block-content">
                        <pre><code id="${blockId}">${escapeHtml(cleanCode)}</code></pre>
                    </div>
                </div>
            `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyCode(elementId, button) {
            const codeElement = document.getElementById(elementId);
            const code = codeElement.textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                button.innerHTML = '‚úì Copied';
                button.classList.add('copied');
                setTimeout(() => {
                    button.innerHTML = 'üìã Copy';
                    button.classList.remove('copied');
                }, 2000);
            });
        }

        async function analyzeCode() {
            const code = editor.getValue().trim();
            
            if (!code || code === '# Paste your code here...') {
                alert('‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á code ‡™≤‡™ñ‡´ã!');
                return;
            }

            // Add user message
            addMessage(true, createCodeBlock(code, currentLanguage, 'Submitted Code'));

            // Show loading
            const analyzeBtn = document.getElementById('analyzeBtn');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = `
                <div class="loading-indicator">
                    <div class="loading-dots">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                    Analyzing...
                </div>
            `;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        code: code,
                        language: currentLanguage
                    })
                });

                if (!response.ok) throw new Error('API request failed');

                const result = await response.json();

                // Build response
                let responseHTML = '';
                
                // Status Badge
                responseHTML += `
                    <div class="error-badge ${result.has_error ? 'yes' : 'no'}">
                        ${result.has_error ? '‚ùå Errors Detected' : '‚úÖ No Errors Found'}
                    </div>
                `;

                // Analysis
                if (result.error_explanation) {
                    responseHTML += `
                        <div class="response-section">
                            <div class="section-label">üìã Analysis</div>
                            <div class="section-content">${result.error_explanation}</div>
                        </div>
                    `;
                }

                // Fixed Code
                if (result.fixed_code) {
                    responseHTML += `
                        <div class="response-section">
                            <div class="section-label">‚ú® ${result.has_error ? 'Fixed Code' : 'Your Code'}</div>
                            ${createCodeBlock(result.fixed_code, currentLanguage, result.has_error ? 'Corrected Version' : 'Original Code')}
                        </div>
                    `;
                }

                // Suggestions
                if (result.suggestions) {
                    responseHTML += `
                        <div class="response-section">
                            <div class="section-label">üí° Suggestions</div>
                            <div class="suggestions-box">${result.suggestions}</div>
                        </div>
                    `;
                }

                addMessage(false, responseHTML);

            } catch (error) {
                addMessage(false, `
                    <div class="error-badge yes">‚ùå Connection Error</div>
                    <div class="section-content">
                        ${error.message}<br><br>
                        <small>Make sure your backend is running on http://localhost:8000</small>
                    </div>
                `);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<span>üîç</span> Analyze Code';
            }
        }

        function clearEditor() {
            editor.setValue('# Paste your code here...\n\n');
        }

        function clearChat() {
            document.getElementById('chatMessages').innerHTML = `
                <div class="welcome-message">
                    <h2>üëã Welcome to CodeMaster AI!</h2>
                    <p>Paste your code in the editor and click "Analyze Code" to get started.</p>
                </div>
            `;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                analyzeCode();
            }
        });
    </script>
</body>
</html>